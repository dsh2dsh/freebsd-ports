PORTNAME=	miniflux
DISTVERSIONPREFIX=	v
DISTVERSION=	2.3.16-122-gbdea57ee
CATEGORIES=	www
PKGNAMESUFFIX=	-${GH_ACCOUNT}

MAINTAINER=	dsh@bamus.cz
COMMENT=	Self-hosted software to read RSS/Atom/JSON feeds (fork with more features)

LICENSE=	APACHE20
LICENSE_FILE=	${WRKSRC}/LICENSE

USES=		go:1.25+,modules

USE_GITHUB=	yes
GH_ACCOUNT=	dsh2dsh

USE_RC_SUBR=	${PORTNAME}

GO_MOD_DIST=	github
GO_MODULE=	${PORTNAME}.app/v2
_BUILD_COMMIT=	bdea57ee
_BUILD_DATE=	date -u "+%Y-%m-%dT%H:%M:%SZ"
_BUILD_XFLAGS=	version.Version=${DISTVERSION} \
		version.Commit=${_BUILD_COMMIT} \
		version.BuildDate=${_BUILD_DATE:sh}
GO_BUILDFLAGS=	-ldflags "${STRIP} ${_BUILD_XFLAGS:S!^!-X miniflux.app/v2/internal/!}"

CONFLICTS_INSTALL=	${PORTNAME}

SUB_FILES=	pkg-message

SUB_LIST=	MINIFLUX_GROUP=${MINIFLUX_GROUP} \
		MINIFLUX_USER=${MINIFLUX_USER}

MINIFLUX_USER?=	${PORTNAME}
MINIFLUX_GROUP?=	${PORTNAME}
USERS=		${MINIFLUX_USER}
GROUPS=		${MINIFLUX_GROUP}

PLIST_SUB=	MINIFLUX_GROUP=${MINIFLUX_GROUP} \
		MINIFLUX_USER=${MINIFLUX_USER}

OPTIONS_DEFINE=		PGSQL_SERVER

PGSQL_SERVER_DESC=	Install the PostgreSQL Server Component
PGSQL_SERVER_USES=	pgsql
PGSQL_SERVER_VARS=	WANT_PGSQL+="server contrib"

post-install:
	${INSTALL_MAN} ${WRKSRC}/${PORTNAME}.1 \
		${STAGEDIR}${PREFIX}/share/man/man1
	${INSTALL_DATA} ${FILESDIR}/${PORTNAME}.env.sample \
		${STAGEDIR}${PREFIX}/etc

.include <bsd.port.mk>
